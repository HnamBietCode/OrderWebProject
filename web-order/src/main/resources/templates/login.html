<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>ÄÄƒng nháº­p</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light d-flex align-items-center justify-content-center" style="min-height: 100vh;">

<div class="card shadow p-4" style="width: 400px;">
    <h3 class="text-center mb-4">ğŸ” ÄÄƒng nháº­p</h3>

    <div id="errorMessage" class="alert alert-danger d-none"></div>

    <form id="loginForm">
        <div class="mb-3">
            <label>TÃªn Ä‘Äƒng nháº­p:</label>
            <input type="text" id="username" class="form-control" required>
        </div>
        <div class="mb-3">
            <label>Máº­t kháº©u:</label>
            <input type="password" id="password" class="form-control" required>
        </div>
        <button type="submit" class="btn btn-primary w-100">ÄÄƒng nháº­p</button>
    </form>

    <div class="text-center mt-3">
        <a href="/">Vá» trang chá»§</a>
    </div>
</div>

<script>
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
        e.preventDefault(); // Cháº·n form load láº¡i trang

        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const errorDiv = document.getElementById('errorMessage');

        try {
            // 1. Gá»i API Ä‘Äƒng nháº­p
            const response = await fetch('/api/auth/signin', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username: username, password: password })
            });

            // 2. Náº¿u Ä‘Äƒng nháº­p thÃ nh cÃ´ng
            if (response.ok) {
                const data = await response.json();

                // 3. LÆ¯U TOKEN VÃ€O COOKIE (Háº¿t háº¡n sau 1 ngÃ y)
                document.cookie = `JWT_TOKEN=${data.token}; path=/; max-age=86400`;

                // 4. Chuyá»ƒn hÆ°á»›ng vá» trang chá»§ (hoáº·c trang Admin)
                window.location.href = "/";
            } else {
                // Náº¿u sai máº­t kháº©u
                errorDiv.textContent = "Sai tÃªn Ä‘Äƒng nháº­p hoáº·c máº­t kháº©u!";
                errorDiv.classList.remove('d-none');
            }
        } catch (error) {
            console.error(error);
            errorDiv.textContent = "Lá»—i káº¿t ná»‘i Server!";
            errorDiv.classList.remove('d-none');
        }
    });
</script>

</body>
</html>